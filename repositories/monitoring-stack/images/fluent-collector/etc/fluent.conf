<system>
    log_level "#{ENV['FC_LOG_LEVEL']}"
</system>

<source>
    @type secure_forward
    shared_key "#{ENV['FC_SHARED_SECRET']}"
    self_hostname fluent-collector.docker
    secure no
</source>

<filter docker>
    @type parser
    key_name log
    reserve_time true
    reserve_data true
    hash_value_field parsed_json_log
    emit_invalid_record_to_error false
    <parse>
        @type json
    </parse>
</filter>

<match fluent.**>
    @type stdout
</match>

<match **>
    @type influxdb
    host "#{ENV['FC_INFLUXDB_HOST']}"
    port "#{ENV['FC_INFLUXDB_PORT']}"
    user "#{ENV['FC_INFLUXDB_USER']}"
    password "#{ENV['FC_INFLUXDB_PASSWORD']}"
    dbname "#{ENV['FC_INFLUXDB_DATABASE']}"

    <buffer>
        @type memory
        flush_interval 3s
    </buffer>
</match>
